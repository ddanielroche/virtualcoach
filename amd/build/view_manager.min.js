define(["jquery","core/templates","core/str","core/notification","core_calendar/events","core_calendar/selectors","mod_virtualcoach/repository"],function(a,b,c,d,e,f,g){var h={COACH_SELECTOR:'select[name="coach"]'},i=function(b){b=a(b),b.on("click",f.links.navLink,function(c){var d=b.find(f.wrapper),e=d.data("view"),g=d.data("courseid"),h=d.data("categoryId"),i=d.data("coach-id"),j=d.data("module-id"),k=a(c.currentTarget);"week"===e&&(l(b,k.attr("href"),k.data("year"),k.data("month"),k.data("day"),g,h,i,j),c.preventDefault())}),b.on("change",h.COACH_SELECTOR,function(){var c=a(this),e=c.val();k(b,e,null).then(function(){return b.find(h.COACH_SELECTOR).val(e)}).fail(d.exception)});var c=a("body");c.off(e.created),c.on(e.created,function(){k(b)}),c.off(e.deleted),c.on(e.deleted,function(){k(b)}),c.off(e.updated),c.on(e.updated,function(){k(b)}),c.off(e.eventMoved),c.on(e.eventMoved,function(){k(b)})},j=function(c,h,i,j,k,l,o,p,q){return m(c),q=q||c.find(f.wrapper),M.util.js_pending([c.get("id"),h,i,j,k,l,o,p].join("-")),g.getCalendarWeekData(h,i,j,k,l,o,p).then(function(a){return b.render(c.attr("data-template"),a)}).then(function(a,c){return b.replaceNode(q,a,c)}).then(function(){return a("body").trigger(e.viewUpdated),!0}).always(function(){return M.util.js_complete([c.get("id"),h,i,j,k,l,o,p].join("-")),n(c)}).fail(d.exception)},k=function(b,c,d){var e=b.find(f.wrapper),g=e.data("year"),i=e.data("month"),k=e.data("day"),l=e.data("module-id"),m=b.find(f.wrapper).data("courseid");return"undefined"==typeof c&&(c=a(h.COACH_SELECTOR).val()),"undefined"==typeof d&&(d=b.find(f.wrapper).data("categoryId")),j(b,g,i,k,m,d,c,l,null)},l=function(a,b,c,d,e,f,g,h,i){return j(a,c,d,e,f,g,h,i,null).then(function(){return b.length&&"#"!==b&&window.history.pushState({},"",b),arguments})},m=function(a){var b=a.find(f.containers.loadingIcon);b.removeClass("hidden")},n=function(a){var b=a.find(f.containers.loadingIcon);b.addClass("hidden")};return{init:function(a){i(a)},reloadCurrentWeek:k,changeWeek:l,refreshWeekContent:j}});